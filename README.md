# nms_pytorch
standalone version of nms included with https://github.com/facebookresearch/maskrcnn-benchmark

STATUS: currently clobbers torchvision. DO NOT use until i fix this

I needed non maximum suppression outside the scope of maskrcnn so I extracted the nms portion of the code and exposed the functions:

```
.nms()
.prepare_boxlist()
.boxlist_nms()

.remove_small_boxes()
.boxlist_iou()
```
This nms handles data quite elegantly. First object of class Boxlist are created
then they are 

## Installation
Similar to benchmark_maskrcnn - minor differences noted here. Testing WIP.
```
# in your conda environment
# ...
conda install ninja yacs cython matplotlib 
conda install cudatoolkit=9 (or =10) ensure cuda tooklit matches your distribution 

# install pytorch and torchvision 
# maskrcnn_benchmark calls for own compilation of vision and for pytorch nightly
# this works with either one
conda install pytorch torchvision -c pytorch

git clone https://github.com/xvdp/nms_pytorch
cd nms_pytorch
python setup.py build develop
```
## Use instructions / Examples


.prepare_boxlist()
Args:
    boxes:          torch.Size([N, 4]) of predicted boxes
    scores:         torch.Size([N, 1]) or torch.Size([N]) of predicted scores
    image_shape:    tuple as generated by ndarray(PilImage) or cv2.imread
    mode:           str, "xyxy", "yxyx", "xywh" or "yxhw"

```
>>> boxlist = nms_pytorch.prepare_boxlist(boxes, scores, image.shape, mode="xyxy")
Out[*]: BoxList(num_boxes=798, image_width=399, image_height=899, mode=xyxy)

filtered = nms_pytorch.boxlist_nms(boxlist, 0.5)
Out[*]: BoxList(num_boxes=262, image_width=399, image_height=899, mode=xyxy)

# filtered.bbox # unsuppressed boxes
# filtered.extra_fields["scores"] # score tensor

```
